<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>webOS Device Detector</title>
  <style>
    :root {
      --bg: #0a2a45;
      --card: #0f3b5e;
      --accent: #3fb6ff;
      --text: #e8f2ff;
      --muted: #8fb3d6;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: "Segoe UI", sans-serif; background: radial-gradient(circle at 20% 20%, #11426b, #071b2c 60%); color: var(--text); display:flex; align-items:center; justify-content:center; min-height:100vh; }
    .card { width:min(520px, 92vw); background:linear-gradient(165deg, rgba(30,78,122,0.9), rgba(7,30,52,0.95)); border:1px solid rgba(63,182,255,0.4); border-radius:16px; padding:22px 24px 18px; box-shadow:0 22px 48px rgba(0,0,0,0.35); }
    h1 { margin:0 0 6px; font-size:24px; letter-spacing:0.5px; }
    p { margin:6px 0 14px; color: var(--muted); }
    .loader { width:54px; height:54px; border-radius:50%; border:4px solid rgba(63,182,255,0.25); border-top-color: var(--accent); animation: spin 1s linear infinite; margin:14px auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .status { text-align:center; margin-top:8px; color: var(--muted); font-size:14px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px 16px; margin-top:16px; }
    .item { background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06); border-radius:10px; padding:10px 12px; }
    .label { color: var(--muted); font-size:12px; text-transform: uppercase; letter-spacing:0.6px; }
    .value { margin-top:4px; font-size:15px; font-weight:600; color: var(--text); word-break: break-all; }
    .ok { color:#4ade80; }
    .err { color:#f87171; }
  </style>
</head>
<body>
  <div class="card">
    <h1>webOS TV Detector</h1>
    <p>Detects TV capabilities via PalmServiceBridge and shows core system properties.</p>
    <div id="loader" class="loader"></div>
    <div id="status" class="status">Initializing…</div>
    <div id="details" class="grid" style="display:none;"></div>
  </div>
  <script>
    (function(){
      var statusEl = document.getElementById('status');
      var detailsEl = document.getElementById('details');
      var loaderEl = document.getElementById('loader');

      function setStatus(msg, ok){
        statusEl.textContent = msg;
        statusEl.className = 'status ' + (ok ? 'ok' : '');
      }

      function showDetails(info){
        detailsEl.innerHTML = '';
        var fields = [
          ['Model', info.modelName],
          ['Serial / Device ID', info.serialNumber || info.deviceId],
          ['Firmware', info.firmwareVersion],
          ['OS Version', info.osVersion || info.osRelease || info.version || info.webosVersion || info.webOSVersion || info.sdkVersion],
          ['Board Type', info.boardType],
          ['Country', info.country],
          ['Platform', info.platformVersion || info.platform_type]
        ];
        fields.forEach(function(pair){
          var label = pair[0], val = pair[1];
          var item = document.createElement('div');
          item.className = 'item';
          var l = document.createElement('div');
          l.className = 'label'; l.textContent = label;
          var v = document.createElement('div');
          v.className = 'value'; v.textContent = val || 'Not available';
          item.appendChild(l); item.appendChild(v);
          detailsEl.appendChild(item);
        });
        detailsEl.style.display = 'grid';
      }

      function fail(msg){
        loaderEl.style.display = 'none';
        setStatus(msg, false);
      }

      function detect(){
        try{
          if (window.PalmServiceBridge) {
            setStatus('Contacting system service…');
            var bridge = new PalmServiceBridge();
            var url = 'luna://com.webos.service.tv.systemproperty/getSystemInfo';
            var params = JSON.stringify({ keys: [
              'modelName','serialNumber','firmwareVersion','osVersion','osRelease','version','webosVersion','webOSVersion','sdkVersion','deviceId','boardType','country','platformVersion','platform_type'
            ]});
            bridge.onservicecallback = function(msg){
              try{
                var res = JSON.parse(msg);
                loaderEl.style.display = 'none';
                setStatus('Device detected successfully', true);
                showDetails(res || {});
              }catch(e){ fail('Parse error: ' + e.message); }
            };
            bridge.call(url, params);
            return;
          }
        }catch(err){ fail('Bridge error: ' + err.message); return; }

        // browser fallback
        loaderEl.style.display = 'none';
        setStatus('PalmServiceBridge not available (not a webOS TV?)', false);
      }

      detect();
    })();
  </script>
</body>
</html>
